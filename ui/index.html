<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quest GPT - AI Powered Automation Installer</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Welcome Modal -->
  <div class="modal" id="welcome-modal" onclick="event.stopPropagation()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <img src="../assets/logo.png" alt="Quest GPT Logo" class="welcome-logo" onerror="console.error('Welcome logo failed'); this.style.display='none';">
      <div class="logo-ascii">
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—<br>
        â•‘   QUEST GPT                   â•‘<br>
        â•‘   AI Powered Installer        â•‘<br>
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      </div>
      <h2>Welcome to Quest GPT</h2>
      <p>Your sassy AI-powered automation installer. Here's how it works:</p>
      <ol style="line-height: 2; margin: 2rem 0;">
        <li><strong>Tell me what you need</strong> - Type anything like "pandas" or "web dev stack"</li>
        <li><strong>Pick your poison</strong> - Select what you actually want to install</li>
        <li><strong>Learn while I work</strong> - Answer MCQs and learn what you're installing</li>
      </ol>
      <p style="font-size: 0.9rem; color: var(--text-secondary);">No boring terminal output. Just knowledge and working software.</p>
      <button class="btn btn-primary" onclick="closeWelcome()">Let's Go</button>
    </div>
  </div>

  <div class="app-container">
    <!-- Header with Logo -->
    <header class="header">
      <div class="logo-section">
        <img src="../assets/logo.png" alt="Quest GPT" class="header-logo" onerror="console.error('Logo failed to load'); this.style.display='none';">
        <div>
          <h1 class="app-title">Quest GPT</h1>
          <span style="font-size: 0.85rem; opacity: 0.7;">AI Powered Automation Installer</span>
        </div>
      </div>
      <div style="display: flex; align-items: center; gap: 1rem;">
        <button class="btn btn-secondary back-to-home-btn" id="back-to-home-btn" onclick="goToHome()" style="display: none; padding: 0.5rem 1rem; font-size: 0.85rem;">â† Home</button>
        <div class="system-info" id="system-info">
          <span class="loading">Detecting system...</span>
        </div>
        <button class="settings-btn" id="settings-btn" onclick="openSettings()" title="Settings">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
          </svg>
        </button>
      </div>
    </header>

    <!-- Quick Search Section -->
    <div class="quick-search-section" id="quick-search-section" style="display: none;">
      
      <!-- Manage Installed Packages â€” Top Banner -->
      <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); padding: 1.5rem 2rem; margin-bottom: 2.5rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
        <div style="display: flex; justify-content: space-between; align-items: center; gap: 2rem;">
          <div style="flex: 1;">
            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
              <h3 style="color: white; margin: 0; font-size: 1.1rem;">ğŸ“¦ Package Manager</h3>
              <div id="last-scan-time" style="color: rgba(255,255,255,0.5); font-size: 0.7rem; display: none;"></div>
            </div>
            <div style="display: flex; gap: 2rem; margin-bottom: 0.8rem;">
              <div>
                <div style="color: rgba(255,255,255,0.7); font-size: 0.75rem; margin-bottom: 0.2rem;">Installed Packages</div>
                <div style="color: white; font-size: 1.3rem; font-weight: 700;" id="stat-installed">â€”</div>
              </div>
              <div>
                <div style="color: rgba(255,255,255,0.7); font-size: 0.75rem; margin-bottom: 0.2rem;">Updates Available</div>
                <div style="color: #ffd700; font-size: 1.3rem; font-weight: 700;" id="stat-updates">â€”</div>
              </div>
            </div>
          </div>
          <div style="display: flex; gap: 1rem;">
            <button class="btn btn-secondary" id="scan-system-btn" onclick="scanSystem()" style="background: rgba(255,255,255,0.2); color: white; border-color: rgba(255,255,255,0.3); padding: 0.7rem 1.5rem;">
              ğŸ” Scan System
            </button>
            <button class="btn btn-primary" id="manage-packages-btn" onclick="showPackageManager()" style="background: white; color: #2c3e50; border-color: white; padding: 0.7rem 2rem;" disabled>
              Manage Packages
            </button>
          </div>
        </div>
      </div>

      <div class="quick-search-container" style="max-width: 900px; margin: 0 auto;">

        <!-- AI Installer â€” Primary (Bigger, Longer Box) -->
        <div style="background: var(--bg-card); border: 3px solid var(--primary); padding: 3.5rem 3rem; border-radius: 14px; margin-bottom: 1.5rem; box-shadow: 0 10px 30px rgba(0, 212, 255, 0.25); min-height: 280px; display: flex; flex-direction: column; justify-content: center;">
          <h2 style="font-size: 2.2rem; margin: 0 0 1rem 0; color: var(--text-primary); font-weight: 700;">ğŸ¤– What do you need?</h2>
          <p style="margin-bottom: 2rem; color: var(--text-secondary); font-size: 1.1rem; line-height: 1.6;">Tell me what software or stack you want. I'll figure out the rest using AI.</p>
          <div class="search-box" style="margin-bottom: 0;">
            <input type="text" id="ai-home-search" placeholder="e.g., pandas, docker, full stack web dev..." class="search-input" onkeypress="if(event.key==='Enter') homeAISearch()" style="font-size: 1.1rem; padding: 1.2rem 1.5rem;" />
            <button class="btn btn-primary" onclick="homeAISearch()" style="padding: 1.2rem 3rem; font-size: 1.05rem;">Analyze</button>
          </div>
        </div>

        <!-- Winget Direct Search â€” Secondary (Under AI box) -->
        <div style="background: var(--bg-card); border: 1px solid var(--border); padding: 1.5rem; border-radius: 8px; opacity: 0.9; margin-bottom: 2rem;">
          <h3 style="font-size: 1.1rem; margin: 0 0 0.4rem 0; color: var(--text-primary); font-weight: 600;">ğŸ“¦ Winget Package Search</h3>
          <p style="margin-bottom: 1rem; color: var(--text-secondary); font-size: 0.85rem;">
            Or install a specific package directly from the winget repository.
          </p>
          <div class="quick-search-box">
            <input type="text" id="winget-quick-search" placeholder="Package name: python, git, nodejs, vscode..." class="quick-search-input" onkeypress="if(event.key==='Enter') quickWingetSearch()" />
            <button class="quick-search-btn" onclick="quickWingetSearch()">Search</button>
          </div>
        </div>

      </div>
    </div>

    <!-- Package Manager View (Hidden by default) -->
    <div class="package-manager-view" id="package-manager-view" style="display: none;">
      <div class="package-manager-header">
        <div class="package-manager-title">
          <button class="back-btn" onclick="hidePackageManager()">â† Back</button>
          <h2>Package Manager</h2>
          <span class="package-count" id="package-count">0 packages</span>
        </div>
        <button class="export-btn" onclick="exportEnvironment()">
          ğŸ’¾ Export State
        </button>
      </div>
      <div class="package-manager-body">
        <!-- Installed Packages Section -->
        <div class="installed-packages-section">
          <h3 class="section-title">ğŸ’» Installed Dev Tools</h3>
          <div class="package-list" id="package-list">
            <div class="package-list-placeholder">
              <div class="placeholder-icon">ğŸ“¦</div>
              <p>No packages installed yet</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Progress Indicator -->
    <div class="progress-indicator">
      <div class="progress-step active" data-step="1">
        <div class="step-number">01</div>
        <div class="step-label">Search</div>
      </div>
      <div class="progress-line"></div>
      <div class="progress-step" data-step="2">
        <div class="step-number">02</div>
        <div class="step-label">Select</div>
      </div>
      <div class="progress-line"></div>
      <div class="progress-step" data-step="3">
        <div class="step-number">03</div>
        <div class="step-label">Install & Learn</div>
      </div>
      <div class="progress-line"></div>
      <div class="progress-step" data-step="4">
        <div class="step-number">04</div>
        <div class="step-label">Done</div>
      </div>
    </div>

    <!-- Main Content - Scrolling Form -->
    <main class="main-content">
      <!-- Section 1: Search -->
      <section class="step-section" id="step-1">
        <h2 class="step-title">01. What do you need?</h2>
        <p style="margin-bottom: 2rem; color: var(--text-secondary);">Tell me what software or stack you want. I'll figure out the rest.</p>
        <div class="search-box">
          <input 
            type="text" 
            id="search-input" 
            placeholder="e.g., pandas, docker, full stack..." 
            class="search-input"
          >
          <button id="search-btn" class="btn btn-primary">Analyze</button>
        </div>
      </section>

      <!-- Section 2: Selection -->
      <section class="step-section hidden" id="step-2">
        <h2 class="step-title">02. Pick what you want</h2>
        <p style="margin-bottom: 2rem; color: var(--text-secondary);">Click to select dependencies. Selected items will be highlighted.</p>
        
        <!-- Mode Toggle (Minimal vs Full) -->
        <div class="mode-toggle-bar" id="mode-toggle-bar" style="display: none;">
          <span class="mode-label">Mode:</span>
          <button class="mode-btn active" id="mode-essential">Essential Only</button>
          <button class="mode-btn" id="mode-full">Full Stack</button>
        </div>

        <!-- Conflict Warnings -->
        <div id="conflict-warnings" class="conflict-warnings" style="display: none;"></div>

        <!-- Stack Options (shown when multiple stack choices available) -->
        <div id="stack-options-container" class="stack-options-container hidden">
          <h3 style="margin-bottom: 1rem; font-size: 1.1rem;">Choose Your Stack:</h3>
          <div id="stack-options-grid" class="stack-options-grid"></div>
          <div style="margin: 2rem 0; padding: 1rem; background: var(--bg-card); border-left: 3px solid var(--primary);">
            <p style="font-size: 0.9rem; color: var(--text-secondary);">Or select individual packages below â†“</p>
          </div>
        </div>
        
        <div id="dependencies-grid" class="dependencies-grid"></div>
        <div class="action-bar">
          <button id="back-btn" class="btn btn-secondary">â† Back</button>
          <button id="uninstall-selected-btn" class="btn btn-secondary" style="background: #c00; border-color: #c00; color: #fff; display: none;">
            Uninstall Selected
          </button>
          <button id="install-btn" class="btn btn-primary" disabled>Select Something</button>
        </div>
      </section>

      <!-- Section 3: Install & Learn -->
      <section class="step-section hidden" id="step-3">
        <h2 class="step-title">03. Installing & Learning</h2>
        
        <!-- Sassy Intro Box -->
        <div class="sassy-intro-box">
          <h3>Sit back, relax, and test your knowledge ğŸ˜</h3>
          <p>We're handling everything - terminal commands, sudo passwords, PATH setup, error fixing. You just answer questions and look smart.</p>
          <p style="font-size: 0.85rem; opacity: 0.8; margin-top: 0.5rem;">No manual config. No googling errors. We got this.</p>
        </div>
        
        <div class="split-view">
          <!-- Left Side: Terminal -->
          <div class="terminal-section">
            <div class="terminal-header">
              <span>â— â— â—</span>
              <span>Terminal Output</span>
            </div>
            <div class="terminal-body" id="terminal-output">
              <div class="terminal-line">Quest GPT Installer v1.0</div>
              <div class="terminal-line">Ready to install...</div>
            </div>
            <div class="terminal-input-area" id="terminal-input-area" style="display: none;">
              <span class="terminal-prompt">$</span>
              <input type="password" id="terminal-input" class="terminal-input" placeholder="Enter sudo password...">
              <button id="terminal-submit" class="terminal-submit-btn">Submit</button>
            </div>
          </div>
          
          <!-- Right Side: Questions -->
          <div class="questions-section">
            <div id="mcq-section" class="mcq-content">
              <p>Generating questions...</p>
            </div>
            <div id="progress-section" class="progress-text"></div>
          </div>
        </div>
      </section>

      <!-- Section 4: Done -->
      <section class="step-section hidden" id="step-4">
        <h2 class="step-title">âœ“ Done!</h2>
        <div id="verification-results" class="verification-results"></div>
        <div class="action-bar">
          <button id="new-search-btn" class="btn btn-primary">Install More Stuff</button>
          <button id="uninstall-btn" class="btn btn-secondary">Uninstall Packages</button>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <p>Quest GPT</p>
    </footer>

    <!-- Installation Complete Modal -->
    <div class="modal" id="complete-modal" style="display: none;">
      <div class="modal-content" onclick="event.stopPropagation()">
        <h2>âœ… Installation Complete</h2>
        <p>Your installs finished successfully. Want me to verify everything now?</p>
        <div class="safety-actions">
          <button class="btn btn-secondary" id="complete-modal-close">Close</button>
          <button class="btn btn-primary" id="complete-modal-continue">Continue</button>
        </div>
      </div>
    </div>

    <!-- Safety Preview Modal -->
    <div class="modal" id="safety-modal" style="display: none;">
      <div class="modal-content safety-modal-content">
        <h2>ğŸ” Command Safety Preview</h2>
        <p>Review the commands that will run on your system before proceeding.</p>
        <div id="safety-summary" class="safety-summary"></div>
        <div id="safety-commands-list" class="safety-commands-list"></div>
        <div class="safety-actions">
          <button class="btn btn-secondary" id="safety-cancel-btn">â† Cancel</button>
          <button class="btn btn-primary" id="safety-proceed-btn">Proceed with Install</button>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settings-modal" style="display: none;">
      <div class="modal-content" style="max-width: 550px;" onclick="event.stopPropagation()">
        <h2>âš™ï¸ Settings</h2>
        
        <!-- AI Provider Selection -->
        <div class="settings-group">
          <label class="settings-label">AI Provider</label>
          <select id="settings-ai-provider" class="settings-select" onchange="onProviderChange()">
            <option value="gemini" selected>Google Gemini (Recommended)</option>
            <option value="openai">OpenAI GPT</option>
            <option value="anthropic">Anthropic Claude</option>
            <option value="groq">Groq (Fast)</option>
          </select>
        </div>

        <!-- Model Selection -->
        <div class="settings-group">
          <label class="settings-label">Model</label>
          <select id="settings-model" class="settings-select">
            <!-- Gemini models (default) -->
            <option value="gemini-2.5-flash" selected>Gemini 2.5 Flash (Default)</option>
            <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash-Lite (Fast)</option>
            <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
            <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
          </select>
        </div>

        <!-- API Key -->
        <div class="settings-group">
          <label class="settings-label">API Key</label>
          <div class="api-key-input-wrapper">
            <input type="password" id="settings-api-key" class="settings-input" placeholder="Enter your API key..." autocomplete="off">
            <button type="button" class="api-key-toggle" onclick="toggleApiKeyVisibility()" title="Show/Hide">
              <span id="api-key-eye">ğŸ‘ï¸</span>
            </button>
          </div>
        </div>

        <!-- MCQ Model (for quiz) -->
        <div class="settings-group">
          <label class="settings-label">Quiz Model (MCQ)</label>
          <select id="settings-mcq-model" class="settings-select">
            <option value="gemini-2.5-flash-lite" selected>Gemini 2.5 Flash-Lite (Default)</option>
            <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
            <option value="same">Same as main model</option>
          </select>
        </div>

        <div class="safety-actions" style="margin-top: 2rem;">
          <button class="btn btn-secondary" onclick="closeSettings()">Cancel</button>
          <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
        </div>
      </div>
    </div>
  </div>

  <script src="renderer.js"></script>
</body>
</html>
